tinymce.PluginManager.add('jzk_appinfo',
function(editor, url) {
	var openDialog = function() {
		return editor.windowManager.open({
			title: '应用信息',
			body: {
				type: 'panel',
				items: [{
					type: 'input',
					name: 'app_mame',
					label: '应用名'
				},
				{
					type: 'input',
					name: 'app_package_mame',
					label: '包名'
				},
				{
					type: 'input',
					name: 'app_version',
					label: '版本'
				},
				{
					type: 'selectbox',
					name: 'app_type',
					size: 1,
					items: [
						{ "text": "系统", "value": "系统" },
						{ "text": "应用", "value": "应用" },
						{ "text": "补丁", "value": "补丁" },
						{ "text": "功能", "value": "功能" }
					],
					label: '类型'
				},
				{
					type: 'textarea',
					name: 'app_known_bug',
					label: '已知Bug'
				},
				{
					type: 'textarea',
					name: 'app_introduction',
					label: '介绍'
				},
				{
					type: 'input',
					name: 'app_download',
					label: '下载地址'
				},
				{
					type: 'textarea',
					name: 'app_other',
					label: '其他'
				}]
			},
			buttons: [{
				type: 'cancel',
				text: '取消'
			},
			{
				type: 'submit',
				text: '完成',
				primary: true
			}],
			onSubmit: function (api) {
				var data = api.getData();

				if (data.app_download === '') { data.app_download = "#" }
				if (data.app_mame === '') { data.app_mame = "." }
				if (data.app_package_mame === '') { data.app_package_mame = "." }
				if (data.app_version === '') { data.app_package_mame = "0.1" }
				if (data.app_introduction === '') { data.app_introduction = "." }
				if (data.app_known_bug === '') { data.app_known_bug = "." }
				if (data.app_other === '') { data.app_other = "." }

				editor.insertContent(
					'<div class="appinfo-container iq-card"><div class="appinfo-left">'
					+ '<img src="' + 'https://via.placeholder.com/256' + '" alt="' + data.app_mame + '" class="rounded img-fluid">'
					+ '<a href="' + data.app_download + '" class="btn btn-primary">下载</a>'
					+ '</div> <div class="appinfo-right">'
					+ '<dl> <dt>应用名</dt> <dd>' + data.app_mame + '</dd> </dl>'
					+ '<dl> <dt>包名</dt> <dd>' + data.app_package_mame + '</dd> </dl>'
					+ '<dl> <dt>版本</dt> <dd>' + data.app_version + '</dd> </dl>'
					+ '<dl> <dt>类型</dt> <dd>' + data.app_type + '</dd></dl>'
					+ '</div></div>'
					+ '<h3 class="text-info">介绍</h3>' + data.app_introduction
					+ '<h3 class="text-info">已知 Bug</h3>' + data.app_known_bug
					+ '<h3 class="text-info">其他</h3>'+data.app_other
				);
				api.close();
			}
		});
	};

	editor.ui.registry.addButton('appinfo', {
		text: '📲',
		tooltip: '插入应用信息栏',
		title: '应用信息栏',
		onAction: function() {
			openDialog();
		}
	});

	return {
		getMetadata: function() {
			return {
				name: '插入应用信息框',
				url: 'https://www.jizhiku.ml/'
			};
		}
	};
});