tinymce.PluginManager.add('jzk_appinfo',
function(editor, url) {
	var openDialog = function() {
		return editor.windowManager.open({
			title: 'åº”ç”¨ä¿¡æ¯',
			body: {
				type: 'panel',
				items: [{
					type: 'input',
					name: 'app_mame',
					label: 'åº”ç”¨å'
				},
				{
					type: 'input',
					name: 'app_package_mame',
					label: 'åŒ…å'
				},
				{
					type: 'input',
					name: 'app_version',
					label: 'ç‰ˆæœ¬'
				},
				{
					type: 'selectbox',
					name: 'app_type',
					size: 1,
					items: [
						{ "text": "ç³»ç»Ÿ", "value": "ç³»ç»Ÿ" },
						{ "text": "åº”ç”¨", "value": "åº”ç”¨" },
						{ "text": "è¡¥ä¸", "value": "è¡¥ä¸" },
						{ "text": "åŠŸèƒ½", "value": "åŠŸèƒ½" }
					],
					label: 'ç±»å‹'
				},
				{
					type: 'textarea',
					name: 'app_known_bug',
					label: 'å·²çŸ¥Bug'
				},
				{
					type: 'textarea',
					name: 'app_introduction',
					label: 'ä»‹ç»'
				},
				{
					type: 'input',
					name: 'app_download',
					label: 'ä¸‹è½½åœ°å€'
				},
				{
					type: 'textarea',
					name: 'app_other',
					label: 'å…¶ä»–'
				}]
			},
			buttons: [{
				type: 'cancel',
				text: 'å–æ¶ˆ'
			},
			{
				type: 'submit',
				text: 'å®Œæˆ',
				primary: true
			}],
			onSubmit: function (api) {
				var data = api.getData();

				if (data.app_download === '') { data.app_download = "#" }
				if (data.app_mame === '') { data.app_mame = "." }
				if (data.app_package_mame === '') { data.app_package_mame = "." }
				if (data.app_version === '') { data.app_package_mame = "0.1" }
				if (data.app_introduction === '') { data.app_introduction = "." }
				if (data.app_known_bug === '') { data.app_known_bug = "." }
				if (data.app_other === '') { data.app_other = "." }

				editor.insertContent(
					'<div class="appinfo-container iq-card"><div class="appinfo-left">'
					+ '<img src="' + 'https://via.placeholder.com/256' + '" alt="' + data.app_mame + '" class="rounded img-fluid">'
					+ '<a href="' + data.app_download + '" class="btn btn-primary">ä¸‹è½½</a>'
					+ '</div> <div class="appinfo-right">'
					+ '<dl> <dt>åº”ç”¨å</dt> <dd>' + data.app_mame + '</dd> </dl>'
					+ '<dl> <dt>åŒ…å</dt> <dd>' + data.app_package_mame + '</dd> </dl>'
					+ '<dl> <dt>ç‰ˆæœ¬</dt> <dd>' + data.app_version + '</dd> </dl>'
					+ '<dl> <dt>ç±»å‹</dt> <dd>' + data.app_type + '</dd></dl>'
					+ '</div></div>'
					+ '<h3 class="text-info">ä»‹ç»</h3>' + data.app_introduction
					+ '<h3 class="text-info">å·²çŸ¥ Bug</h3>' + data.app_known_bug
					+ '<h3 class="text-info">å…¶ä»–</h3>'+data.app_other
				);
				api.close();
			}
		});
	};

	editor.ui.registry.addButton('appinfo', {
		text: 'ğŸ“²',
		tooltip: 'æ’å…¥åº”ç”¨ä¿¡æ¯æ ',
		title: 'åº”ç”¨ä¿¡æ¯æ ',
		onAction: function() {
			openDialog();
		}
	});

	return {
		getMetadata: function() {
			return {
				name: 'æ’å…¥åº”ç”¨ä¿¡æ¯æ¡†',
				url: 'https://www.jizhiku.ml/'
			};
		}
	};
});